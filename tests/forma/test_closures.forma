# Test closures and higher-order functions
# Expected output: All tests pass, final result: 1

# Simple closure with no captures
f test_simple_closure() -> Bool
    add_one := |x: Int| x + 1
    add_one(5) == 6

# Closure with captures
f test_closure_capture() -> Bool
    offset := 10
    add_offset := |x: Int| x + offset
    add_offset(5) == 15

# Higher-order function: apply
# Note: FORMA doesn't have function types yet, so we'll test closures differently
f test_closure_call() -> Bool
    double := |x: Int| x * 2
    result := double(7)
    result == 14

# Multiple captured vformables
f test_multiple_captures() -> Bool
    base := 100
    multiplier := 2
    calc := |x: Int| base + x * multiplier
    calc(5) == 110

f run_all_tests() -> Int
    passed := 0
    if test_simple_closure() then passed = passed + 1 else print("FAIL: test_simple_closure")
    if test_closure_capture() then passed = passed + 1 else print("FAIL: test_closure_capture")
    if test_closure_call() then passed = passed + 1 else print("FAIL: test_closure_call")
    if test_multiple_captures() then passed = passed + 1 else print("FAIL: test_multiple_captures")

    print("Closure tests passed:")
    print(passed)
    print("of 4")

    if passed == 4 then 0 else 1

f main() -> Int = run_all_tests()
